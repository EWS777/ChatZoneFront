
<div class="app-wrapper">

  @if(!isConfirmEmailPage()){
    <div class="auth-container">
      <div>
        <button name="button-login" (click)="isLogin.set(true)">Login</button>
        <button name="button-login" (click)="isLogin.set(false)">Rejestracja</button>
      </div>

      @if(isLogin()){
        <form class="login-form" [formGroup]="loginForm" (ngSubmit)="onLoginSubmit()">
          @if (commonErrorLogin) {
            <div> {{ commonErrorLogin }} </div>
          }
          <label class="login-labels">
            Username/Email
            <input formControlName = "usernameOrEmail" class="login-inputs" type="text" placeholder="example123">
            @if (loginForm.controls.usernameOrEmail.touched && loginForm.controls.usernameOrEmail.invalid){
              @if(loginForm.controls.usernameOrEmail.errors?.["required"]) {<small>usernameOrEmail is required</small>}
              @if(loginForm.controls.usernameOrEmail.errors?.["minLength"]) {<small>Min length is {{ loginForm.get('usernameOrEmail')?.errors?.['minLength'].requiredLength }}</small>}
              @if(loginForm.controls.usernameOrEmail.errors?.["maxLength"]) {<small>Max length is {{ loginForm.get('usernameOrEmail')?.errors?.['maxLength'].requiredLength }}</small>}
              @if (loginForm.controls.usernameOrEmail.errors?.["spaces"]) {<small>Can not contains spaces</small>}
              @if(loginForm.controls.usernameOrEmail.errors?.["pattern"]) {<small>usernameOrEmail can not contains special symbols, just '_' and '-'</small>}
              @if (loginForm.controls.usernameOrEmail.hasError('email')) { <small>Email is not valid</small> }
            }
            @if (loginForm.controls.usernameOrEmail.errors?.['backend']; as backendErrors) {
              @for (err of backendErrors; track err) {
                <small>{{ err }}</small>
              }
            }
          </label>

          <label class="login-labels">
            Password
            <input formControlName = "password" class="login-inputs" type="text" placeholder="example123">
            @if (loginForm.controls.password.touched && loginForm.controls.password.invalid){
              @if(loginForm.controls.password.errors?.["required"]) {<small>password is required</small>}
              @if(loginForm.controls.password.errors?.["minLength"]) {<small>Min length is 8</small>}
              @if(loginForm.controls.password.errors?.["maxLength"]) {<small>Max length is 64</small>}
              @if (loginForm.controls.password.errors?.["spaces"]) {<small>Can not contains spaces</small>}
            }
            @if (loginForm.controls.password.errors?.['backend']; as backendErrors) {
              @for (err of backendErrors; track err) {
                <small>{{ err }}</small>
              }
            }
          </label>

          <button type="submit">Login</button>
          <a [routerLink]="['/reset-password']">Zapomninałeś hasła?</a>
        </form>
      }
      @else {
        <form class="login-form" [formGroup]="registrationForm" (ngSubmit)="onRegistrationSubmit()">
          @if (commonError) {
            <div>{{ commonError }}</div>
          }
          <label class="auth-labels">
            Email
            <input formControlName = "email" class="auth-inputs" type="text" placeholder="example123">
            @if (registrationForm.controls.email.invalid && registrationForm.controls.email.touched) {
              @if (registrationForm.controls.email.hasError('email')) { <small>Email is not valid</small> }
              @if(registrationForm.controls.email.errors?.["required"]) {<small>email is required</small>}
              @if(registrationForm.controls.email.errors?.["minLength"]) {<small>Min length is 5</small>}
              @if(registrationForm.controls.email.errors?.["maxLength"]) {<small>Max length is 254</small>}
              @if (registrationForm.controls.email.errors?.["spaces"]) {<small>Can not contains spaces</small>}
            }
            @if (registrationForm.controls.email.errors?.['backend']; as backendErrors) {
              @for (err of backendErrors; track err) {
                <small>{{ err }}</small>
              }
            }
          </label>

          <label class="auth-labels">
            Username
            <input formControlName = "username" class="auth-inputs" type="text" placeholder="example123">
              @if (registrationForm.controls.username.touched && registrationForm.controls.username.invalid){
                @if(registrationForm.controls.username.errors?.["required"]) {<small>username is required</small>}
                @if(registrationForm.controls.username.errors?.["minLength"]) {<small>Min length is 8</small>}
                @if(registrationForm.controls.username.errors?.["maxLength"]) {<small>Max length is 30</small>}
                @if (registrationForm.controls.username.errors?.["spaces"]) {<small>Can not contains spaces</small>}
                @if(registrationForm.controls.username.errors?.["pattern"]) {<small>Username can not contains special symbols, just '_' and '-'</small>}
              }
            @if (registrationForm.controls.username.errors?.['backend']; as backendErrors) {
              @for (err of backendErrors; track err) {
                <small>{{ err }}</small>
              }
            }
          </label>

          <label class="auth-labels">
            Password
            <input formControlName = "password" class="auth-inputs" type="text" placeholder="example123">
            @if(registrationForm.errors?.["passwordMismatch"]) {<small>Passwords do not match</small>}
              @if (registrationForm.controls.password.touched && registrationForm.controls.password.invalid){
                @if(registrationForm.controls.password.errors?.["required"]) {<small>password is required</small>}
                @if(registrationForm.controls.password.errors?.["minLength"]) {<small>Min length is 8</small>}
                @if(registrationForm.controls.password.errors?.["maxLength"]) {<small>Max length is 64</small>}
                @if (registrationForm.controls.password.errors?.["spaces"]) {<small>Can not contains spaces</small>}
              }
            @if (registrationForm.controls.password.errors?.['backend']; as backendErrors) {
              @for (err of backendErrors; track err) {
                <small>{{ err }}</small>
              }
            }
          </label>

          <label class="auth-labels">
            Confirm Password
            <input formControlName = "confirmedPassword" class="auth-inputs" type="text" placeholder="example123">
            @if(registrationForm.errors?.["passwordMismatch"]) {<small>Passwords do not match</small>}
              @if (registrationForm.controls.confirmedPassword.touched && registrationForm.controls.confirmedPassword.invalid){
                @if(registrationForm.controls.confirmedPassword.errors?.["required"]) {<small>password is required</small>}
                @if(registrationForm.controls.confirmedPassword.errors?.["minLength"]) {<small>Min length is 8</small>}
                @if(registrationForm.controls.confirmedPassword.errors?.["maxLength"]) {<small>Max length is 64</small>}
                @if (registrationForm.controls.confirmedPassword.errors?.["spaces"]) {<small>Can not contains spaces</small>}
              }
          </label>

          <button type="submit">Zarejestruj się</button>
        </form>
      }
    </div>
  } @else {
    Proszę podtwierdzić email żeby aktywować konto. Link został wysłany mailowo
    <a [routerLink]="['/']">Przejdź do strony głównej</a>
  }
</div>
