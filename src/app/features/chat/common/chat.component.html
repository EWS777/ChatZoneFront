<div class="container">
  <div class="chat-header">
    <button (click)="changeIsDisconnectStatus('exit')">Back</button>
    @if (chatPersonInfo.isSingleChat) {
      <div class="chat-param">
        <span>Username: qwerty123</span>
        <span>Age: 20-25</span>
        <span>Gender: Man</span>
        <span>Country: Poland</span>
      </div>
    } @else {
      <div class="chat-param">
        <span>GroupName: {{ group.title }}</span>
        @if (group.country !== null) {
          <span>Country: {{ CountryList[group.country] }}</span>
        }
        @if (group.city !== null) {
          <span>City: {{ CityList[group.city] }}</span>
        }
        @if (group.age !== null) {
          <span>Age: {{ AgeList[group.age] }}</span>
        }
        @if (group.lang !== null) {
          <span>Lang: {{ LangList[group.lang] }}</span>
        }
      </div>
    }
    @if (chatPersonInfo.isSingleChat || (!chatPersonInfo.isSingleChat && group.isAdmin)) {
      <button (click)="isActivateSettings.set(!isActivateSettings())">⚙️</button>
    }

  </div>

  <div #chatContainer class="chat-messages" (scroll)="onScroll()">
    <ul>
      @for (msg of messages; track $index) {
        <li [ngClass]="{ 'mine-message': msg.idSender === chatPersonInfo.idPerson, 'another-message': msg.idSender !== chatPersonInfo.idPerson }">
          {{msg.message}}
        </li>
      }
    </ul>
  </div>

  <div class="chat-footer-wrapper">
    @if (chatPersonInfo.isSingleChat){
      <h2>SINGLE CHAT</h2>
    } @else {
      <h2>GROUP CHAT</h2>
    }
    @if (!chatPersonInfo.isSentMessage) {
      <div class="chat-quick-message">
        @for (quickMessage of quickMessageList; track quickMessage.idQuickMessage) {
          <button (click)="sendQuickMessage(quickMessage.message)">{{ quickMessage.message }}</button>
        }
      </div>
    }
  </div>

  <div class="chat-footer">
    @if (chatPersonInfo.isSingleChat) {
      <button (click)="changeIsDisconnectStatus('skip')">Skip</button>
    }
    <input [(ngModel)]="currentMessage" placeholder="Message"/>
    <button (click)="sendMessage()">Send</button>
  </div>

  @if (isDisconnect() === 'skip') {
    <div class="common-information">
      Do you want to skip person?
      <button (click)="exitChat(false)">Yes</button>
      <button (click)="changeIsDisconnectStatus(null)">No</button>
    </div>
  }

  @if (isActivateSettings()) {
    @if (chatPersonInfo.isSingleChat) {
      <div class="common-information">
        <button (click)="blockPerson()">Block user</button>
        @if (isPersonBlocked()) {
          <h2><span>Person has blocked!</span></h2>
          Do you want to find a new person?
          <button (click)="findNewPerson()">Yes</button>
          <button (click)="router.navigate(['/'])">No</button>
        }
      </div>
    }
    @if (!chatPersonInfo.isSingleChat && group.isAdmin) {
      <div class="common-information">
        <button (click)="isActivateSettings.set(false)">Back</button>
        <button (click)="getGroupMembers()">List of users</button>
        <div class="update-group-params">
          <b>Change group params</b>
          <br>Title:  <input [(ngModel)]="groupEditable.title">

          <div class="form-group">
            <label for="country">Country:</label>
            <select id="country" [(ngModel)]="groupEditable.country">
              @for (country of countryList; track country.value) {
                <option [ngValue]="country.value">{{ country.label }}</option>
              }
            </select>
          </div>

          <div class="form-group">
            <label for="city">City:</label>
            <select id="city" [(ngModel)]="groupEditable.city">
              @for (city of cityList; track city.value) {
                <option [ngValue]="city.value">{{ city.label }}</option>
              }
            </select>
          </div>

          <div class="form-group">
            <label for="age">Age:</label>
            <select id="age" [(ngModel)]="groupEditable.age">
              @for (age of ageList; track age.value) {
                <option [ngValue]="age.value">{{ age.label }}</option>
              }
            </select>
          </div>

          <div class="form-group">
            <label for="language">Language</label>
            <select id="language" [(ngModel)]="groupEditable.lang">
              @for (gender of langList; track gender.value) {
                <option [ngValue]="gender.value">{{ gender.label }}</option>
              }
            </select>
          </div>
          <button (click)="updateGroupData()">Update info</button>
        </div>
      </div>
    }
  }
</div>


@if (isDisconnect() === 'exit') {
  <div class="common-information">
    Do you want to quite chat?
    <button (click)="exitChat(true)">Yes</button>
    <button (click)="changeIsDisconnectStatus(null)">No</button>
  </div>
}

@if(isAdminStatusInfo()){
  <div class="common-information">
    You are an admin. What action do you prefer?
    <button (click)="deleteGroupChat()">Delete group</button>
    <button (click)="getGroupMembers()">Set another admin</button>
  </div>
}

@if(isNewAdminNotification() && group.isAdmin){
  <div class="common-information">
    You are a new admin of this group!
    <button (click)="isNewAdminNotification.set(false)">Great!</button>
  </div>
}

@if (isDeleteGroupStatus()) {
  <div class="common-information">
    The group was deleted!
    <button (click)="router.navigate(['/'])">Okay</button>
  </div>
}

@if (isOtherPersonLeft()) {
  <div class="common-information">
    <h2>Person has disconnected!</h2>
    Do you want to find new person?
    <button (click)="findNewPerson()">Yes</button>
    <button (click)="router.navigate(['/'])">No</button>
  </div>
}

@if (isShowNewFinder()){
  <div class="common-information">
    <h2>Waiting for new matching...</h2>
  </div>
}

@if (isGroupMember()){
  <div class="common-information">
    <button (click)="isGroupMember.set(false)">Back</button>
    <h2>List of group members</h2>
    @for (members of groupMembers; track members.idPerson){
      <div>
        <span>{{members.username}}</span>
        <button (click)="blockFromGroupChat(members.idPerson)">Block user</button>
        <button (click)="setNewAdmin(members.idPerson)">Set admin</button>
      </div>
    }
  </div>
}
